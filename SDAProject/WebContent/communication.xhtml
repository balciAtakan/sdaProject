<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/templates/struktur.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<ui:define name="title">
        Communication
    </ui:define>
   	<ui:define name="styles">
    	<link rel="stylesheet" href="resources/css/communication.css" type="text/css"/>
    </ui:define>	

	<ui:define name="main_content">
	
	<h:form id="baseForm" >
		<b:panel id="personPanel" style="width:20%;height:100%">
			<h:panelGrid id="personGrid" columns="1" >
				
				<p:accordionPanel id="baseAccord" activeIndex="null" styleClass="accordion_channel">
					<p:tab id="baseTab" title="#{communicationBean.currUser.firstname} #{communicationBean.currUser.lastname}">
			  
		                <p:dataTable id="personTable" value="#{communicationBean.rooms}" var="room">
		                	<f:facet name="header">
					            <p:commandButton id="newRoomButton" style="background:azure" icon="fa fa-plus" value="New Room"
		                				 oncomplete="PF('roomDlg').show();"/>
					        </f:facet>
		                	<p:column>
		                		<b:commandButton id="roomnameButton" value="#{room.roomname}" 
		                						 action="#{communicationBean.processEnterRoom}">
		                			<f:setPropertyActionListener target="#{communicationBean.activeRoom}" value="#{room}"/>
		                		</b:commandButton>
		                	</p:column>
		                
		                </p:dataTable>
			        </p:tab>
				
				</p:accordionPanel>
				
			</h:panelGrid>
		</b:panel>
	</h:form>
	<h:form id="roomPanel" style="position: absolute;left:20%;top:44px;width: 50%;height:100%;">
		<b:panel id="roomUnit" position="center" collapsed="false" rendered="#{communicationBean.activeRoom.history != null}" 
			     title="#{communicationBean.activeRoom.roomname}"> 
			<b:alert severity="success" id="baseAlert" closable="true" >
				Wellcome to <strong>#{communicationBean.activeRoom.roomname}!</strong>
				
			</b:alert>
			<div>
				<b:dataTable id="messageTable" var="mes" value="#{communicationBean.activeRoom.history}" 
							 paginated="false" searching="false" info="false"> 
					<b:column>
						<b:button disabled="true" value="#{mes.messageOwner.username}"/> 
						<h:outputText id="plainMessag" rendered="#{!mes.found}" value=" #{mes.message}"/>
						<h:outputText id="foundMessag" rendered="#{mes.found}" value=" #{mes.message}" style="text-decoration: underline;"/>
					</b:column>
					
				
				</b:dataTable>
			</div>
			<script type="text/javascript">
					$(document).ready(function() {
					    $('#messageTable').DataTable( {
					        "scrollY": 200
					        
					    } );
					} );  
			    </script>
			
			<b:inputTextarea placeholder="Type here..." value="#{communicationBean.message}"/>
		    <b:commandButton id="sendButton" value="Send" span="2" offset="10" style="background:#dff0d8" actionListener="#{communicationBean.processMessage}" 
		    				 update="roomPanel">
				<f:setPropertyActionListener target="#{communicationBean.message}" value="#{null}"/>
			</b:commandButton>	
			<b:defaultCommand target="sendButton"/>			
		
		</b:panel>
	</h:form>
	<h:form id="wordPanel" style="position: absolute;left:70%;top: 44px;width: 28%;" rendered="true">
		<b:panel id="wordUnit" title="Words" rendered="false">
		</b:panel>
	</h:form>
		
		
		<ui:remove>
		<p:layout style="min-width:500px;min-height:700px;">
		    <p:layoutUnit position="west" header="Knowledge Rooms" resizable="true" collapsible="true" size="300" minSize="50" maxSize="400">
		       <div id="firstPan">
		       			
		       
		       
		       
		       </div>
		       <div>
		       
		       
		       
		       
		       </div>
		        
		        
		        
		        
		        
		    </p:layoutUnit>
		 
			<p:layoutUnit position="center" header="Chat">
		       <p:fieldset id="container">
 
		        <h:panelGroup>
		        	<p:inputText disabled="true" style="width:100%;height:300px;" id="chatfield" value="#{communicationBean.message}"/>
		            <br/>
		            <p:inputText placeholder="Message" value="#{communicationBean.message}"/>
		            
		            <p:commandButton value="Send" update="chatfield" />
		        </h:panelGroup> 
			    </p:fieldset>
			</p:layoutUnit>
			<p:layoutUnit position="east" header="Knowledge" resizable="false" collapsible="true" size="400" minSize="50" maxSize="600">
		       Words
			</p:layoutUnit>
			
		</p:layout>
		</ui:remove>
	
	<h:form id="dialog_form">
		<p:dialog id="addRoomDialog" widgetVar="roomDlg" modal="true" height="620" width="550" header="Add New Knowledge Room" closable="false">
				
			<p:messages id="dialog_messages" autoUpdate="true" closable="false" />
			
				<p:outputLabel style="text-align:center;margin-right:5px;" value="Room name*  " />
				<p:inputText value="#{communicationBean.newRoom.roomname}" />
				
				<p:dataTable var="role" value="#{communicationBean.roles}" selection="#{communicationBean.selectedRoles}" style="margin-top:10px"
							 rowKey="#{role.role()}" >
					<f:facet name="header">
			            Allowed User Roles in Room
			        </f:facet>
			        <p:column selectionMode="multiple" style="width:36px;text-align:center"/>
			        <p:column headerText="Role">
			            <h:outputText value="#{role.role()}" />
			        </p:column>
				
				
				</p:dataTable>
				
				<p:spacer/>
				
			<h:panelGrid columns="2" style="width:100%">
		    	<p:commandButton value="Cancel" style="float:left;background-color:aliceblue" onclick="PF('roomDlg').hide();"/>
		    	<p:commandButton value="Create Room" style="float:right;background-color:aliceblue" action="#{communicationBean.processCreateRoom}" />
		    </h:panelGrid>
				
		</p:dialog>
	</h:form>
	
	<h:form id="enterroom_dialog_form">
		<p:dialog id="enterRoomDialog" widgetVar="enterRoomDlg" modal="true" style="postion:absolute;top:40%;left:40%;width:300px;height:175px" 
				  header="Do you want to enter room (#{communicationBean.activeRoom.roomname}) ?" closable="false">
				
			<h:panelGrid columns="2" style="width:100%">
		    	<b:commandButton value="Cancel" style="background-color:aliceblue" onclick="PF('enterRoomDlg').hide();">
		    		<f:setPropertyActionListener target="#{communicationBean.activeRoom}" value="#{null}"/>
		    	</b:commandButton>
		    	<b:commandButton value="Enter" style="background-color:aliceblue" actionListener="#{communicationBean.loadRoomData}" 
		    					 oncomplete="PF('enterRoomDlg').hide();" update="roomPanel"/>
		    </h:panelGrid>
				
		</p:dialog>
	</h:form>
	
	<h:form id="denied_enterroom_dialog_form">
		<p:dialog id="deniedEnterRoomDlg" widgetVar="deniedEnterRoom" modal="true" height="80" width="500" style="postion:absolute;top:40%;left:40%" 
				  header="Sorry! You are not allowed to enter THIS room (#{communicationBean.activeRoom.roomname}) " closable="false">
				  
		    	<b:commandButton value="OK" style="background-color:aliceblue;text-align:right" onclick="PF('deniedEnterRoom').hide();"/>
		</p:dialog>
	</h:form>
	</ui:define>
</ui:composition>